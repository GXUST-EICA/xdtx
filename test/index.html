<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
	<title>åä¼šåŸ¹è®­ä¸­å¿ƒ</title>
	<style>
		:root {
			--primary: #6c5ce7;
			--secondary: #a8a4e6;
			--accent: #ff6b6b;
			--background: linear-gradient(160deg, #f8f9ff 0%, #f3f5ff 100%);
			--glass: rgba(255, 255, 255, 0.95);
			--shadow: 0 12px 40px rgba(108, 92, 231, 0.1);
			--radius: 16px; /* ç»Ÿä¸€åœ†è§’ */
			--tap-highlight: rgba(108, 92, 231, 0.1); /* ç‚¹å‡»åé¦ˆè‰² */
		}

		/* åŠ¨æ€ç›®å½•ç”Ÿæˆæ ·å¼ */
		.toc-category {
			background: var(--glass);
			backdrop-filter: blur(12px);
			border-radius: 12px;
			margin: 1rem 0;
			padding: 1rem;
			box-shadow: var(--shadow);
			transition: transform 0.2s ease;
			position: relative;
		}

		/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
		@media (max-width: 768px) {
			.sidebar {
				width: 85%;
				transform: translateX(-100%);
				transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
				box-shadow: 8px 0 40px rgba(108, 92, 231, 0.15);
				backdrop-filter: blur(20px);
			}

			.sidebar.active {
				transform: translateX(0);
			}
		}

		/* æ–°å¢åŠŸèƒ½ï¼šæœç´¢æ¡† */
		.search-box {
			padding: 1rem;
			position: sticky;
			top: 0;
			background: var(--glass);
			backdrop-filter: blur(10px);
			z-index: 200;
		}

		/* ç§»åŠ¨ç«¯èœå•æŒ‰é’®ä¼˜åŒ– */
		.menu-toggle {
			position: fixed;
			top: 1rem;
			left: 1rem;
			z-index: 300;
			background: var(--glass);
			border: none;
			padding: 0.8rem;
			border-radius: 50%;
			box-shadow: var(--shadow);
			-webkit-tap-highlight-color: var(--tap-highlight);
		}

		/* æ–°å¢é˜…è¯»è¿›åº¦æ¡ */
		.progress-bar {
			position: fixed;
			top: 0;
			left: 0;
			height: 3px;
			background: var(--accent);
			z-index: 500;
		}

		/* ä¼˜åŒ–ç§»åŠ¨ç«¯ç›®å½•äº¤äº’ */
		.toc-category h3 {
			cursor: pointer;
			padding: 12px;
			margin: -12px;
			border-radius: var(--radius);
			-webkit-tap-highlight-color: var(--tap-highlight);
		}
		.toc-category[data-fold="true"] .toc-subitem {
			display: none;
		}

		/* å¢å¼ºæœç´¢é«˜äº® */
		.highlight {
			background: linear-gradient(90deg, #ffd70033, #ffd70000);
			border-radius: 4px;
		}
	</style>
</head>

<body>
	<!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
	<button class="menu-toggle">â˜°</button>

	<!-- ä¾§è¾¹æ ç›®å½• -->
	<nav class="sidebar">
		<div class="search-box">
			<input type="text" id="search" placeholder="ğŸ” æœç´¢è¯¾ç¨‹..."
				style="width:100%; padding:0.8rem; border-radius:8px; border:1px solid var(--secondary)">
		</div>
		<div class="toc" id="dynamic-toc"></div>
	</nav>

	<!-- å†…å®¹åŒºåŸŸ -->
	<main class="content">
		<h1>åä¼šåŸ¹è®­ä¸­å¿ƒ</h1>
		<div class="course-content"></div>
	</main>

	<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
	<script>
		// åŠ¨æ€ç”Ÿæˆç›®å½•
		const courseFiles = [
			// ç¼–ç¨‹è¯­è¨€åŸºç¡€
			"test/md/ç¼–ç¨‹è¯­è¨€åŸºç¡€ - Cè¯­è¨€.md",
			"test/md/ç¼–ç¨‹è¯­è¨€åŸºç¡€ - Python.md",

			// ç¡¬ä»¶åŸºç¡€
			"test/md/ç¡¬ä»¶åŸºç¡€çŸ¥è¯† - ç”µè·¯åŸºç¡€.md",
			"test/md/ç¡¬ä»¶åŸºç¡€çŸ¥è¯† - MCUæ¦‚å¿µåŠæ¶æ„.md",

			// å•ç‰‡æœºåè®®
			"test/md/å•ç‰‡æœºçš„åè®® - STM32.md",
			"test/md/å•ç‰‡æœºçš„åè®® - ä¸²å£åŠ©æ‰‹.md",

			// å¼€å‘ç¯å¢ƒ
			"test/md/å¼€å‘ç¯å¢ƒåŠå…¶å›ºä»¶åº“ - æ ‡å‡†åº“.md",
			"test/md/å¼€å‘ç¯å¢ƒåŠå…¶å›ºä»¶åº“ - HALåº“.md",

			// PCBè®¾è®¡
			"test/md/PCBè®¾è®¡ä¸åˆ¶ä½œ - å­¦ä¹ ä½¿ç”¨EDAå·¥å…·.md",
			"test/md/PCBè®¾è®¡ä¸åˆ¶ä½œ - å…è´¹æ‰“æ ·æ¿.md",

			// æœºå™¨è§†è§‰
			"test/md/æœºå™¨è§†è§‰ - åŸºç¡€è§†è§‰å¤„ç†ä¸Matlab.md",
			"test/md/æœºå™¨è§†è§‰ - OpenMV.md",
			"test/md/æœºå™¨è§†è§‰ - Linuxä¸OpenCVï¼ˆåˆè¯†ç¯‡ï¼‰.md",
			"test/md/æœºå™¨è§†è§‰ - Linuxä¸OpenCV-Linuxç¯‡(ä¸€).md"
		];

		// åŠ¨æ€ç”Ÿæˆç›®å½•ç»“æ„
		function generateTOC() {
			const tocMap = new Map();

			courseFiles.forEach(path => {
				const [category, filename] = path.split('/').pop().split(' - ');
				if (!tocMap.has(category)) {
					tocMap.set(category, []);
				}
				tocMap.get(category).push({
					name: filename.replace('.md', ''),
					path: path
				});
			});

			let tocHTML = '';
			tocMap.forEach((items, category) => {
				tocHTML += `
                    <div class="toc-category">
                        <h3>${category}</h3>
                        ${items.map(item => `
                            <div class="toc-subitem" data-file="${item.path}">
                                ${item.name}
                            </div>
                        `).join('')}
                    </div>
                `;
			});

			document.getElementById('dynamic-toc').innerHTML = tocHTML;
		}

		// æ–°å¢åŠŸèƒ½ï¼šç›®å½•æŠ˜å 
		function setupCategoryFold() {
			document.querySelectorAll('.toc-category h3').forEach(h3 => {
				h3.addEventListener('click', () => {
					const category = h3.parentElement;
					const isFolded = category.getAttribute('data-fold') === 'true';
					category.setAttribute('data-fold', !isFolded);
				});
			});
		}

		// æ–°å¢åŠŸèƒ½ï¼šé˜…è¯»è¿›åº¦æ¡
		function setupProgressBar() {
			const progressBar = document.createElement('div');
			progressBar.className = 'progress-bar';
			document.body.prepend(progressBar);
			
			window.addEventListener('scroll', () => {
				const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
				const progress = (window.scrollY / scrollHeight) * 100;
				progressBar.style.width = progress + '%';
			});
		}

		// å¢å¼ºæœç´¢åŠŸèƒ½ï¼ˆæ”¯æŒå®æ—¶é«˜äº®ï¼‰
		document.getElementById('search').addEventListener('input', (e) => {
			const term = e.target.value.trim().toLowerCase();
			document.querySelectorAll('.toc-subitem').forEach(item => {
				const text = item.textContent;
				const regex = new RegExp(`(${term})`, 'gi');
				item.innerHTML = term ? 
					text.replace(regex, '<span class="highlight">$1</span>') : 
					text;
				item.style.display = term ? 
					(text.toLowerCase().includes(term) ? 'block' : 'none') : 
					'block';
			});
		});

		// æ–°å¢ç§»åŠ¨ç«¯æ‰‹åŠ¿æ”¯æŒ
		let touchStartX = 0;
		document.addEventListener('touchstart', e => {
			touchStartX = e.touches[0].clientX;
		});
		document.addEventListener('touchend', e => {
			const deltaX = e.changedTouches[0].clientX - touchStartX;
			if (Math.abs(deltaX) > 50 && window.innerWidth <= 768) {
				document.querySelector('.sidebar').classList.toggle('active', deltaX > 0);
			}
		});

		// åˆå§‹åŒ–æ–°åŠŸèƒ½
		generateTOC();
		setupCategoryFold();
		setupProgressBar();

		// å¢å¼ºå†…å®¹åŠ è½½ï¼ˆæ·»åŠ åŠ è½½çŠ¶æ€ï¼‰
		document.addEventListener('click', async (e) => {
			if (e.target.closest('.toc-subitem')) {
				const contentArea = document.querySelector('.course-content');
				contentArea.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨åŠ è½½å†…å®¹...</p>
                    </div>
                `;
				
				const item = e.target.closest('.toc-subitem');
				const filePath = item.dataset.file;

				try {
					const response = await fetch(filePath);
					const markdown = await response.text();
					contentArea.innerHTML = `
                        <article class="markdown-content">
                            ${marked.parse(markdown)}
                        </article>
                    `;

					// æ·»åŠ å†å²è®°å½•
					history.pushState({}, '', `#${encodeURIComponent(filePath)}`);

					// è‡ªåŠ¨æ»šåŠ¨åˆ°å†…å®¹åŒº
					contentArea.scrollIntoView({ behavior: 'smooth' });
				} catch (error) {
					contentArea.innerHTML = `
                        <div class="error">
                            <h3>âš ï¸ å†…å®¹åŠ è½½å¤±è´¥</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
				}
			}
		});

		// æ–°å¢æŒä¹…åŒ–å­˜å‚¨
		window.addEventListener('beforeunload', () => {
			localStorage.setItem('lastScroll', window.scrollY);
		});
		window.addEventListener('load', () => {
			const lastScroll = localStorage.getItem('lastScroll');
			if (lastScroll) window.scrollTo(0, lastScroll);
		});

		// ç§»åŠ¨ç«¯ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
		document.addEventListener('click', (e) => {
			if (window.innerWidth <= 768 &&
				!e.target.closest('.sidebar') &&
				!e.target.closest('.menu-toggle')) {
				document.querySelector('.sidebar').classList.remove('active');
			}
		});
	</script>
</body>

</html>