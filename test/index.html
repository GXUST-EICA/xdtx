<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>知识库 | 极简文档中心</title>
	
	<!-- 核心资源 -->
	<script src="style/marked.min.js" defer></script>
	<link rel="stylesheet" href="style/prism-okaidia.min.css">
	<link rel="preload" href="style/MiSans-Regular.ttf" as="font" crossorigin>
	<script src="style/prism.min.js" defer></script>
	<link rel="stylesheet" href="style/all.min.css">
	
	<!-- 优化后的样式 -->
	<style>
		/* 基础变量 */
		:root {
			--primary: #6366f1;
			--secondary: #818cf8;
			--surface: rgba(255, 255, 255, 0.98);
			--bg: #f8fafc;
			--text: #1e293b;
			--radius-m: 12px;
			--radius-s: 6px;
			--shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.1);
			--nav-width: 280px;
			--transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}

		/* 基础重置 */
		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		}

		/* 字体定义 */
		@font-face {
			font-family: 'MiSans';
			src: url('style/MiSans-Regular.ttf') format('truetype');
			font-display: swap;
		}

		body {
			font-family: 'MiSans', system-ui, -apple-system;
			background: var(--bg);
			line-height: 1.6;
			-webkit-font-smoothing: antialiased;
		}

		/* 布局组件 */
		.app-container {
			display: grid;
			grid-template-columns: var(--nav-width) 1fr;
			min-height: 100vh;
		}

		.nav-container {
			position: fixed;
			left: 0;
			top: 0;
			width: var(--nav-width);
			height: 100vh;
			background: var(--surface);
			backdrop-filter: blur(16px);
			padding: 1.5rem;
			overflow-y: auto;
			transform: translateX(-100%);
			transition: transform var(--transition);
			z-index: 1000;
		}

		.content-container {
			grid-column: 2;
			padding: 2rem;
			max-width: 800px;
			margin: 0 auto;
			transition: filter var(--transition);
			opacity: 1;
			min-height: 100vh;
		}

		/* 移动端适配 */
		@media (max-width: 768px) {
			.app-container {
				grid-template-columns: 1fr;
			}

			.content-container {
				margin-left: 0;
				width: 100%;
			}

			.nav-container.active {
				transform: translateX(0);
			}

			.nav-container.active + .content-container {
				filter: blur(2px);
				pointer-events: none;
			}

			.menu-toggle {
				display: flex;
				align-items: center;
				gap: 8px;
			}
		}

		/* 桌面端适配 */
		@media (min-width: 769px) {
			.app-container {
				display: block;
			}
			
			.nav-container {
				transform: translateX(0);
				position: fixed;
			}
			
			.content-container {
				margin-left: var(--nav-width);
				width: calc(100% - var(--nav-width));
				padding: 2rem;
			}
		}

		/* 组件样式 */
		.doc-card {
			--hover-elevation: 0 6px 16px -2px rgba(0, 0, 0, 0.1);
			
			padding: 1.25rem;
			margin: 0.75rem 0;
			background: var(--surface);
			border-radius: var(--radius-s);
			box-shadow: var(--shadow);
			transition: 
				transform 0.2s ease,
				box-shadow 0.2s ease;
		}

		.doc-card:hover {
			transform: translateY(-2px);
			box-shadow: var(--hover-elevation);
		}

		/* 工具类 */
		.sr-only {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip: rect(0, 0, 0, 0);
			border: 0;
		}

		.menu-toggle {
			position: fixed;
			top: 1rem;
			left: 1rem;
			z-index: 1001;
			padding: 0.5rem 1rem;
			background: var(--primary);
			color: white;
			border: none;
			border-radius: var(--radius-s);
			cursor: pointer;
			display: none;
		}

		.content-container img {
			max-width: 100%;
		}
		.content-container pre {
			overflow-x: auto;
			background: #2d2d2d;
			padding: 1rem;
			border-radius: var(--radius-s);
		}
	</style>
</head>

<body>
	<div class="app-container">
		<!-- 导航区域 -->
		<aside class="nav-container" id="nav">
			<h1 class="sr-only">知识库导航</h1>
		</aside>

		<!-- 内容区域 -->
		<main class="content-container" id="content">
			<button class="menu-toggle" aria-label="切换导航菜单">
				<i class="fas fa-bars"></i> 知识库
			</button>
		</main>
	</div>

	<!-- 优化后的脚本 -->
	<script>
		class KnowledgeBase {
			constructor(config) {
				this.config = config;
				this.cache = new Map();
				this.init();
			}

			init() {
				this.initDOMReferences();
				this.renderNavigation();
				this.setupEventListeners();
				this.autoLoadFirstDocument();
			}

			initDOMReferences() {
				this.nav = document.getElementById('nav');
				this.content = document.getElementById('content');
				this.menuToggle = document.querySelector('.menu-toggle');
			}

			renderNavigation() {
				const fragment = document.createDocumentFragment();
				
				Object.entries(this.config).forEach(([category, items]) => {
					const section = document.createElement('section');
					section.innerHTML = `
						<h2 style="margin: 1rem 0; color: var(--primary);">
							${category}
						</h2>
					`;

					items.forEach(path => {
						const card = this.createCardElement(path);
						section.appendChild(card);
					});

					fragment.appendChild(section);
				});

				this.nav.appendChild(fragment);
			}

			createCardElement(path) {
				const card = document.createElement('article');
				card.className = 'doc-card';
				card.textContent = this.getFileName(path);
				card.tabIndex = 0;
				card.addEventListener('click', () => this.loadDocument(path));
				card.addEventListener('keypress', (e) => {
					if (e.key === 'Enter') this.loadDocument(path);
				});
				return card;
			}

			async loadDocument(path) {
				try {
					const cached = this.cache.get(path);
					if (cached) return this.renderContent(cached);

					this.showLoading();
					const response = await fetch(path);
					if (!response.ok) throw new Error(`加载失败: ${response.status}`);
					
					const markdown = await response.text();
					const html = marked.parse(markdown);
					
					this.cache.set(path, html);
					this.renderContent(html);
					this.handleMobileLayout();
				} catch (error) {
					this.showError(error);
				}
			}

			renderContent(html) {
				this.content.innerHTML = html;
				Prism.highlightAll();
				this.addHeadingAnchors();
			}

			setupEventListeners() {
				this.menuToggle.addEventListener('click', () => 
					this.nav.classList.toggle('active')
				);

				window.addEventListener('resize', () => {
					if (window.innerWidth > 768) {
						this.nav.classList.remove('active');
					}
				});
			}

			showLoading() {
				this.content.innerHTML = `<div class="doc-card">加载中...</div>`;
			}

			showError(error) {
				this.content.innerHTML = `
					<div class="doc-card" style="color:red">
						<h3>加载失败</h3>
						<p>${error.message}</p>
					</div>
				`;
			}

			addHeadingAnchors() {
				document.querySelectorAll('h2, h3, h4').forEach(heading => {
					const anchor = document.createElement('a');
					anchor.href = `#${heading.id}`;
					anchor.className = 'heading-anchor';
					heading.prepend(anchor);
				});
			}

			autoLoadFirstDocument() {
				const firstCategory = Object.values(this.config)[0];
				if (firstCategory && firstCategory.length > 0) {
					this.loadDocument(firstCategory[0]);
				}
			}
		}

		// 初始化应用
		const config = {
			"技术文档": [
				// 编程语言基础
				"test/md/编程语言基础 - C语言.md",
				"test/md/编程语言基础 - Python.md",
				
				// 硬件基础
				"test/md/硬件基础知识 - 电路基础.md",
				"test/md/硬件基础知识 - MCU概念及架构.md",
				
				// 单片机协议
				"test/md/单片机的协议 - STM32.md",
				"test/md/单片机的协议 - 串口助手.md",
				
				// 开发环境
				"test/md/开发环境及其固件库 - 标准库.md",
				"test/md/开发环境及其固件库 - HAL库.md",
				
				// PCB设计
				"test/md/PCB设计与制作 - 学习使用EDA工具.md",
				"test/md/PCB设计与制作 - 免费打样板.md",
				
				// 机器视觉
				"test/md/机器视觉 - 基础视觉处理与Matlab.md",
				"test/md/机器视觉 - OpenMV.md",
				"test/md/机器视觉 - Linux与OpenCV（初识篇）.md",
				"test/md/机器视觉 - Linux与OpenCV-Linux篇(一).md"
			]
		};
		new KnowledgeBase(config);
	</script>
</body>

</html>